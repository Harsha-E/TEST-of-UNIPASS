<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reset Password • Uni Pass</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script src="/assets/js/route-guard.js"></script>
<style>
*{box-sizing:border-box;font-family:Inter,system-ui,sans-serif}
body{
 margin:0;height:100vh;display:grid;place-items:center;
 background:linear-gradient(135deg,#141e30,#243b55);color:#fff
}
.card{
 width:min(420px,92%);padding:2rem;border-radius:16px;
 background:rgba(255,255,255,.08);backdrop-filter:blur(14px);
 box-shadow:0 20px 60px rgba(0,0,0,.45)
}
h1{margin:.2rem 0 1rem;font-size:1.5rem}
p{font-size:.85rem;color:#ccc;margin-bottom:1.4rem}
input{
 width:100%;padding:.9rem;margin:.5rem 0;border-radius:10px;
 border:1px solid rgba(255,255,255,.2);
 background:transparent;color:#fff
}
button{
 margin-top:1rem;width:100%;padding:.9rem;border-radius:10px;
 border:none;background:#6ee7b7;color:#000;font-weight:600
}
.msg{margin-top:.8rem;font-size:.8rem;display:none}
.ok{color:#7dffb3}
.err{color:#ff9d9d}
.rule{font-size:.7rem;color:#aaa;margin-top:.4rem}
</style>
</head>

<body>
<div class="card">
  <h1>Reset Your Password</h1>
  <p>This is your first login. You must set a new password to continue.</p>

  <input id="new" type="password" placeholder="New password">
  <input id="confirm" type="password" placeholder="Confirm password">

  <div class="rule">• At least 8 characters</div>
  <div class="rule">• Must include letters & numbers</div>
  <div class="rule">• Cannot be your previous password</div>

  <button onclick="reset()">Reset Password</button>
  <div class="msg" id="msg"></div>
</div>

<script>
/* HARD BLOCK: user must be logged in */
if(!sessionStorage.getItem("loggedIn")){
 location.replace("/public/login.html")
}

/* simulate old password hash (placeholder) */
const OLD = "old-password"

function strong(p){
 return p.length>=8 && /[a-zA-Z]/.test(p) && /\d/.test(p)
}

function reset(){
 const n=document.getElementById("new").value
 const c=document.getElementById("confirm").value
 const m=document.getElementById("msg")
 m.style.display="block"

 if(n!==c){
  m.className="msg err"; m.textContent="Passwords do not match"; return
 }
 if(!strong(n)){
  m.className="msg err"; m.textContent="Password too weak"; return
 }
 if(n===OLD){
  m.className="msg err"; m.textContent="Cannot reuse old password"; return
 }

 /* success */
 sessionStorage.setItem("firstLogin","false")
 m.className="msg ok"
 m.textContent="Password updated successfully"

 setTimeout(()=>{
  const role=sessionStorage.getItem("role")
  if(role==="admin") location.replace("/admin/admin.html")
  else if(role==="hod") location.replace("/portals/hod/portalA.html")
  else if(role==="teacher") location.replace("/portals/teacher/portalA.html")
  else location.replace("/portals/student/portalA.html")
 },1200)
}
</script>
</body>
</html>
